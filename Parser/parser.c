#include "parser.h"
#include "../Lexer/lexer.h"


/*
 * A top down order precedence parser (Pratt parser).
 * Input: Token stream of the Python language generated by lexer.c/main.c.
 * Output: AST to be translate into lower-level IR by tree-walker
 */


Precedence associate_precedence(TokenType type){
    switch (type) {
        case TOKEN_ADD:
        case TOKEN_MINUS:
            return AddSub;
        case TOKEN_DIVISION:
        case TOKEN_MULTIPLICATION:
            return MultDiv;
        default:
            // Defaults to lowest precendence level
            return Outcomes;
    }
}


ParserToken spawn_parse_token(Token input_token){
    ParserToken return_token;

    // These lines capture our lexeme in a variable
    char *lexeme = malloc((input_token.length+1) * sizeof(char));
    for (int i = 0; i <= input_token.length; i++) {
        lexeme[i] = input_token.first_char[i];
    }
    lexeme[input_token.length] = '\0';

    return_token.lexeme = lexeme;
    return_token.type = input_token.type;
    // Check type, return appropiate precendence for TDOP parser
    return_token.precendence = associate_precedence(input_token.type);

    return return_token;
}


// low level debugging, spawn_parse_token() then print_parse_token()
// to see if its working correctly
void print_parse_token(ParserToken input_token){
    printf("Type: '%s'\n", print_type(input_token.type));
    printf("Lexeme: '%s'\n", input_token.lexeme);
    printf("Precedence: '%d'\n", input_token.precendence);
    printf("\n");
}
